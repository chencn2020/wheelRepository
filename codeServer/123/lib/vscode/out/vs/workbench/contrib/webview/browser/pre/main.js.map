{"version":3,"sources":["vs/workbench/contrib/webview/browser/pre/main.js"],"names":["trackFocus","onFocus","onBlur","isFocused","document","hasFocus","setInterval","isCurrentlyFocused","getActiveFrame","getElementById","getPendingFrame","defaultCssRules","createWebviewManager","host","loadTimeout","firstLoad","pendingMessages","initData","initialScrollProgress","undefined","applyStyles","body","classList","remove","add","activeTheme","styles","variable","Object","keys","documentElement","style","setProperty","handleInnerClick","event","view","baseElement","getElementsByTagName","node","target","tagName","toLowerCase","href","getAttribute","scrollTo","hash","indexOf","scrollTarget","substr","length","scrollIntoView","postMessage","baseVal","preventDefault","parentNode","handleAuxClick","button","handleInnerKeydown","e","key","keyCode","code","shiftKey","altKey","ctrlKey","metaKey","repeat","isHandlingScroll","handleWheel","deltaMode","deltaX","deltaY","deltaZ","detail","type","handleInnerScroll","progress","currentTarget","scrollY","clientHeight","isNaN","window","requestAnimationFrame","toContentHtml","data","options","text","contents","newDocument","DOMParser","parseFromString","querySelectorAll","forEach","a","title","allowScripts","defaultScript","createElement","id","textContent","state","JSON","stringify","head","prepend","defaultStyles","innerHTML","csp","querySelector","endpoint","endpointUrl","URL","setAttribute","replace","origin","console","error","outerHTML","addEventListener","idMatch","location","search","match","ID","onMessage","_event","contentDocument","contentWindow","focus","updateId","async","currentUpdateId","ready","frame","wasFirstLoad","setInitialScrollPosition","scroll","previousPendingFrame","removeChild","newFrame","fakeLoad","src","cssText","appendChild","open","setTimeout","write","close","hookupOnLoadHandlers","onLoad","oldActiveFrame","visibility","focusIframeOnCreate","clearTimeout","this","onIframeLoaded","push","execCommand","module","exports"],"mappings":"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","file":"main.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// @ts-check\n\n/**\n * @typedef {{\n *   postMessage: (channel: string, data?: any) => void,\n *   onMessage: (channel: string, handler: any) => void,\n *   focusIframeOnCreate?: boolean,\n *   ready?: Promise<void>,\n *   onIframeLoaded?: (iframe: HTMLIFrameElement) => void,\n *   fakeLoad: boolean\n * }} WebviewHost\n */\n\n(function () {\n\t'use strict';\n\n\t/**\n\t * Use polling to track focus of main webview and iframes within the webview\n\t *\n\t * @param {Object} handlers\n\t * @param {() => void} handlers.onFocus\n\t * @param {() => void} handlers.onBlur\n\t */\n\tconst trackFocus = ({ onFocus, onBlur }) => {\n\t\tconst interval = 50;\n\t\tlet isFocused = document.hasFocus();\n\t\tsetInterval(() => {\n\t\t\tconst isCurrentlyFocused = document.hasFocus();\n\t\t\tif (isCurrentlyFocused === isFocused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisFocused = isCurrentlyFocused;\n\t\t\tif (isCurrentlyFocused) {\n\t\t\t\tonFocus();\n\t\t\t} else {\n\t\t\t\tonBlur();\n\t\t\t}\n\t\t}, interval);\n\t};\n\n\tconst getActiveFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('active-frame'));\n\t};\n\n\tconst getPendingFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('pending-frame'));\n\t};\n\n\tconst defaultCssRules = `\n\tbody {\n\t\tbackground-color: var(--vscode-editor-background);\n\t\tcolor: var(--vscode-editor-foreground);\n\t\tfont-family: var(--vscode-font-family);\n\t\tfont-weight: var(--vscode-font-weight);\n\t\tfont-size: var(--vscode-font-size);\n\t\tmargin: 0;\n\t\tpadding: 0 20px;\n\t}\n\n\timg {\n\t\tmax-width: 100%;\n\t\tmax-height: 100%;\n\t}\n\n\ta {\n\t\tcolor: var(--vscode-textLink-foreground);\n\t}\n\n\ta:hover {\n\t\tcolor: var(--vscode-textLink-activeForeground);\n\t}\n\n\ta:focus,\n\tinput:focus,\n\tselect:focus,\n\ttextarea:focus {\n\t\toutline: 1px solid -webkit-focus-ring-color;\n\t\toutline-offset: -1px;\n\t}\n\n\tcode {\n\t\tcolor: var(--vscode-textPreformat-foreground);\n\t}\n\n\tblockquote {\n\t\tbackground: var(--vscode-textBlockQuote-background);\n\t\tborder-color: var(--vscode-textBlockQuote-border);\n\t}\n\n\tkbd {\n\t\tcolor: var(--vscode-editor-foreground);\n\t\tborder-radius: 3px;\n\t\tvertical-align: middle;\n\t\tpadding: 1px 3px;\n\n\t\tbackground-color: hsla(0,0%,50%,.17);\n\t\tborder: 1px solid rgba(71,71,71,.4);\n\t\tborder-bottom-color: rgba(88,88,88,.4);\n\t\tbox-shadow: inset 0 -1px 0 rgba(88,88,88,.4);\n\t}\n\t.vscode-light kbd {\n\t\tbackground-color: hsla(0,0%,87%,.5);\n\t\tborder: 1px solid hsla(0,0%,80%,.7);\n\t\tborder-bottom-color: hsla(0,0%,73%,.7);\n\t\tbox-shadow: inset 0 -1px 0 hsla(0,0%,73%,.7);\n\t}\n\n\t::-webkit-scrollbar {\n\t\twidth: 10px;\n\t\theight: 10px;\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tbackground-color: var(--vscode-scrollbarSlider-background);\n\t}\n\t::-webkit-scrollbar-thumb:hover {\n\t\tbackground-color: var(--vscode-scrollbarSlider-hoverBackground);\n\t}\n\t::-webkit-scrollbar-thumb:active {\n\t\tbackground-color: var(--vscode-scrollbarSlider-activeBackground);\n\t}`;\n\n\t/**\n\t * @param {*} [state]\n\t * @return {string}\n\t */\n\tfunction getVsCodeApiScript(state) {\n\t\treturn `\n\t\t\tconst acquireVsCodeApi = (function() {\n\t\t\t\tconst originalPostMessage = window.parent.postMessage.bind(window.parent);\n\t\t\t\tconst targetOrigin = '*';\n\t\t\t\tlet acquired = false;\n\n\t\t\t\tlet state = ${state ? `JSON.parse(${JSON.stringify(state)})` : undefined};\n\n\t\t\t\treturn () => {\n\t\t\t\t\tif (acquired) {\n\t\t\t\t\t\tthrow new Error('An instance of the VS Code API has already been acquired');\n\t\t\t\t\t}\n\t\t\t\t\tacquired = true;\n\t\t\t\t\treturn Object.freeze({\n\t\t\t\t\t\tpostMessage: function(msg) {\n\t\t\t\t\t\t\treturn originalPostMessage({ command: 'onmessage', data: msg }, targetOrigin);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsetState: function(newState) {\n\t\t\t\t\t\t\tstate = newState;\n\t\t\t\t\t\t\toriginalPostMessage({ command: 'do-update-state', data: JSON.stringify(newState) }, targetOrigin);\n\t\t\t\t\t\t\treturn newState;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgetState: function() {\n\t\t\t\t\t\t\treturn state;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t})();\n\t\t\tdelete window.parent;\n\t\t\tdelete window.top;\n\t\t\tdelete window.frameElement;\n\t\t`;\n\t}\n\n\t/**\n\t * @param {WebviewHost} host\n\t */\n\tfunction createWebviewManager(host) {\n\t\t// state\n\t\tlet firstLoad = true;\n\t\tlet loadTimeout;\n\t\tlet pendingMessages = [];\n\n\t\tconst initData = {\n\t\t\tinitialScrollProgress: undefined\n\t\t};\n\n\n\t\t/**\n\t\t * @param {HTMLDocument?} document\n\t\t * @param {HTMLElement?} body\n\t\t */\n\t\tconst applyStyles = (document, body) => {\n\t\t\tif (!document) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (body) {\n\t\t\t\tbody.classList.remove('vscode-light', 'vscode-dark', 'vscode-high-contrast');\n\t\t\t\tbody.classList.add(initData.activeTheme);\n\t\t\t}\n\n\t\t\tif (initData.styles) {\n\t\t\t\tfor (const variable of Object.keys(initData.styles)) {\n\t\t\t\t\tdocument.documentElement.style.setProperty(`--${variable}`, initData.styles[variable]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {MouseEvent} event\n\t\t */\n\t\tconst handleInnerClick = (event) => {\n\t\t\tif (!event || !event.view || !event.view.document) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet baseElement = event.view.document.getElementsByTagName('base')[0];\n\t\t\t/** @type {any} */\n\t\t\tlet node = event.target;\n\t\t\twhile (node) {\n\t\t\t\tif (node.tagName && node.tagName.toLowerCase() === 'a' && node.href) {\n\t\t\t\t\tif (node.getAttribute('href') === '#') {\n\t\t\t\t\t\tevent.view.scrollTo(0, 0);\n\t\t\t\t\t} else if (node.hash && (node.getAttribute('href') === node.hash || (baseElement && node.href.indexOf(baseElement.href) >= 0))) {\n\t\t\t\t\t\tlet scrollTarget = event.view.document.getElementById(node.hash.substr(1, node.hash.length - 1));\n\t\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\t\tscrollTarget.scrollIntoView();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thost.postMessage('did-click-link', node.href.baseVal || node.href);\n\t\t\t\t\t}\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @param {MouseEvent} event\n\t\t */\n\t\tconst handleAuxClick =\n\t\t\t(event) => {\n\t\t\t\t// Prevent middle clicks opening a broken link in the browser\n\t\t\t\tif (!event.view || !event.view.document) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (event.button === 1) {\n\t\t\t\t\tlet node = /** @type {any} */ (event.target);\n\t\t\t\t\twhile (node) {\n\t\t\t\t\t\tif (node.tagName && node.tagName.toLowerCase() === 'a' && node.href) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t/**\n\t\t * @param {KeyboardEvent} e\n\t\t */\n\t\tconst handleInnerKeydown = (e) => {\n\t\t\thost.postMessage('did-keydown', {\n\t\t\t\tkey: e.key,\n\t\t\t\tkeyCode: e.keyCode,\n\t\t\t\tcode: e.code,\n\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\taltKey: e.altKey,\n\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\trepeat: e.repeat\n\t\t\t});\n\t\t};\n\n\t\tlet isHandlingScroll = false;\n\n\t\tconst handleWheel = (event) => {\n\t\t\tif (isHandlingScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thost.postMessage('did-scroll-wheel', {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\tdetail: event.detail,\n\t\t\t\ttype: event.type\n\t\t\t});\n\t\t};\n\n\t\tconst handleInnerScroll = (event) => {\n\t\t\tif (!event.target || !event.target.body) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (isHandlingScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst progress = event.currentTarget.scrollY / event.target.body.clientHeight;\n\t\t\tif (isNaN(progress)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisHandlingScroll = true;\n\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\ttry {\n\t\t\t\t\thost.postMessage('did-scroll', progress);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// noop\n\t\t\t\t}\n\t\t\t\tisHandlingScroll = false;\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * @return {string}\n\t\t */\n\t\tfunction toContentHtml(data) {\n\t\t\tconst options = data.options;\n\t\t\tconst text = data.contents;\n\t\t\tconst newDocument = new DOMParser().parseFromString(text, 'text/html');\n\n\t\t\tnewDocument.querySelectorAll('a').forEach(a => {\n\t\t\t\tif (!a.title) {\n\t\t\t\t\ta.title = a.getAttribute('href');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// apply default script\n\t\t\tif (options.allowScripts) {\n\t\t\t\tconst defaultScript = newDocument.createElement('script');\n\t\t\t\tdefaultScript.id = '_vscodeApiScript';\n\t\t\t\tdefaultScript.textContent = getVsCodeApiScript(data.state);\n\t\t\t\tnewDocument.head.prepend(defaultScript);\n\t\t\t}\n\n\t\t\t// apply default styles\n\t\t\tconst defaultStyles = newDocument.createElement('style');\n\t\t\tdefaultStyles.id = '_defaultStyles';\n\t\t\tdefaultStyles.innerHTML = defaultCssRules;\n\t\t\tnewDocument.head.prepend(defaultStyles);\n\n\t\t\tapplyStyles(newDocument, newDocument.body);\n\n\t\t\t// Check for CSP\n\t\t\tconst csp = newDocument.querySelector('meta[http-equiv=\"Content-Security-Policy\"]');\n\t\t\tif (!csp) {\n\t\t\t\thost.postMessage('no-csp-found');\n\t\t\t} else {\n\t\t\t\t// Rewrite vscode-resource in csp\n\t\t\t\tif (data.endpoint) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst endpointUrl = new URL(data.endpoint);\n\t\t\t\t\t\t// NOTE@coder: Add back the trailing slash so it'll work for sub-paths.\n\t\t\t\t\t\tcsp.setAttribute('content', csp.getAttribute('content').replace(/vscode-resource:(?=(\\s|;|$))/g, endpointUrl.origin + \"/\"));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('Could not rewrite csp');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// set DOCTYPE for newDocument explicitly as DOMParser.parseFromString strips it off\n\t\t\t// and DOCTYPE is needed in the iframe to ensure that the user agent stylesheet is correctly overridden\n\t\t\treturn '<!DOCTYPE html>\\n' + newDocument.documentElement.outerHTML;\n\t\t}\n\n\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\tconst idMatch = document.location.search.match(/\\bid=([\\w-]+)/);\n\t\t\tconst ID = idMatch ? idMatch[1] : undefined;\n\t\t\tif (!document.body) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thost.onMessage('styles', (_event, data) => {\n\t\t\t\tinitData.styles = data.styles;\n\t\t\t\tinitData.activeTheme = data.activeTheme;\n\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (!target) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (target.contentDocument) {\n\t\t\t\t\tapplyStyles(target.contentDocument, target.contentDocument.body);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// propagate focus\n\t\t\thost.onMessage('focus', () => {\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.contentWindow.focus();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// update iframe-contents\n\t\t\tlet updateId = 0;\n\t\t\thost.onMessage('content', async (_event, data) => {\n\t\t\t\tconst currentUpdateId = ++updateId;\n\t\t\t\tawait host.ready;\n\t\t\t\tif (currentUpdateId !== updateId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst options = data.options;\n\t\t\t\tconst newDocument = toContentHtml(data);\n\n\t\t\t\tconst frame = getActiveFrame();\n\t\t\t\tconst wasFirstLoad = firstLoad;\n\t\t\t\t// keep current scrollY around and use later\n\t\t\t\tlet setInitialScrollPosition;\n\t\t\t\tif (firstLoad) {\n\t\t\t\t\tfirstLoad = false;\n\t\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\t\tif (!isNaN(initData.initialScrollProgress)) {\n\t\t\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\t\t\twindow.scroll(0, body.clientHeight * initData.initialScrollProgress);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tconst scrollY = frame && frame.contentDocument && frame.contentDocument.body ? frame.contentWindow.scrollY : 0;\n\t\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\t\twindow.scroll(0, scrollY);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Clean up old pending frames and set current one as new one\n\t\t\t\tconst previousPendingFrame = getPendingFrame();\n\t\t\t\tif (previousPendingFrame) {\n\t\t\t\t\tpreviousPendingFrame.setAttribute('id', '');\n\t\t\t\t\tdocument.body.removeChild(previousPendingFrame);\n\t\t\t\t}\n\t\t\t\tif (!wasFirstLoad) {\n\t\t\t\t\tpendingMessages = [];\n\t\t\t\t}\n\n\t\t\t\tconst newFrame = document.createElement('iframe');\n\t\t\t\tnewFrame.setAttribute('id', 'pending-frame');\n\t\t\t\tnewFrame.setAttribute('frameborder', '0');\n\t\t\t\tnewFrame.setAttribute('sandbox', options.allowScripts ? 'allow-scripts allow-forms allow-same-origin' : 'allow-same-origin');\n\t\t\t\tif (host.fakeLoad) {\n\t\t\t\t\t// We should just be able to use srcdoc, but I wasn't\n\t\t\t\t\t// seeing the service worker applying properly.\n\t\t\t\t\t// Fake load an empty on the correct origin and then write real html\n\t\t\t\t\t// into it to get around this.\n\t\t\t\t\tnewFrame.src = `./fake.html?id=${ID}`;\n\t\t\t\t}\n\t\t\t\tnewFrame.style.cssText = 'display: block; margin: 0; overflow: hidden; position: absolute; width: 100%; height: 100%; visibility: hidden';\n\t\t\t\tdocument.body.appendChild(newFrame);\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\t// write new content onto iframe\n\t\t\t\t\tnewFrame.contentDocument.open();\n\t\t\t\t}\n\n\t\t\t\tnewFrame.contentWindow.addEventListener('DOMContentLoaded', e => {\n\t\t\t\t\t// Workaround for https://bugs.chromium.org/p/chromium/issues/detail?id=978325\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (host.fakeLoad) {\n\t\t\t\t\t\t\tnewFrame.contentDocument.open();\n\t\t\t\t\t\t\tnewFrame.contentDocument.write(newDocument);\n\t\t\t\t\t\t\tnewFrame.contentDocument.close();\n\t\t\t\t\t\t\thookupOnLoadHandlers(newFrame);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst contentDocument = e.target ? (/** @type {HTMLDocument} */ (e.target)) : undefined;\n\t\t\t\t\t\tif (contentDocument) {\n\t\t\t\t\t\t\tapplyStyles(contentDocument, contentDocument.body);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 0);\n\t\t\t\t});\n\n\t\t\t\t/**\n\t\t\t\t * @param {Document} contentDocument\n\t\t\t\t * @param {Window} contentWindow\n\t\t\t\t */\n\t\t\t\tconst onLoad = (contentDocument, contentWindow) => {\n\t\t\t\t\tif (contentDocument && contentDocument.body) {\n\t\t\t\t\t\t// Workaround for https://github.com/Microsoft/vscode/issues/12865\n\t\t\t\t\t\t// check new scrollY and reset if necessary\n\t\t\t\t\t\tsetInitialScrollPosition(contentDocument.body, contentWindow);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newFrame = getPendingFrame();\n\t\t\t\t\tif (newFrame && newFrame.contentDocument && newFrame.contentDocument === contentDocument) {\n\t\t\t\t\t\tconst oldActiveFrame = getActiveFrame();\n\t\t\t\t\t\tif (oldActiveFrame) {\n\t\t\t\t\t\t\tdocument.body.removeChild(oldActiveFrame);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Styles may have changed since we created the element. Make sure we re-style\n\t\t\t\t\t\tapplyStyles(newFrame.contentDocument, newFrame.contentDocument.body);\n\t\t\t\t\t\tnewFrame.setAttribute('id', 'active-frame');\n\t\t\t\t\t\tnewFrame.style.visibility = 'visible';\n\t\t\t\t\t\tif (host.focusIframeOnCreate) {\n\t\t\t\t\t\t\tnewFrame.contentWindow.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcontentWindow.addEventListener('scroll', handleInnerScroll);\n\t\t\t\t\t\tcontentWindow.addEventListener('wheel', handleWheel);\n\n\t\t\t\t\t\tpendingMessages.forEach((data) => {\n\t\t\t\t\t\t\tcontentWindow.postMessage(data, '*');\n\t\t\t\t\t\t});\n\t\t\t\t\t\tpendingMessages = [];\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t/**\n\t\t\t\t * @param {HTMLIFrameElement} newFrame\n\t\t\t\t */\n\t\t\t\tfunction hookupOnLoadHandlers(newFrame) {\n\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\tloadTimeout = setTimeout(() => {\n\t\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\t\tonLoad(newFrame.contentDocument, newFrame.contentWindow);\n\t\t\t\t\t}, 200);\n\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('load', function (e) {\n\t\t\t\t\t\tconst contentDocument = /** @type {Document} */ (e.target);\n\n\t\t\t\t\t\tif (loadTimeout) {\n\t\t\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\t\t\tonLoad(contentDocument, this);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Bubble out various events\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('click', handleInnerClick);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('auxclick', handleAuxClick);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('keydown', handleInnerKeydown);\n\t\t\t\t\tnewFrame.contentWindow.addEventListener('contextmenu', e => e.preventDefault());\n\n\t\t\t\t\tif (host.onIframeLoaded) {\n\t\t\t\t\t\thost.onIframeLoaded(newFrame);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\thookupOnLoadHandlers(newFrame);\n\t\t\t\t}\n\n\t\t\t\tif (!host.fakeLoad) {\n\t\t\t\t\tnewFrame.contentDocument.write(newDocument);\n\t\t\t\t\tnewFrame.contentDocument.close();\n\t\t\t\t}\n\n\t\t\t\thost.postMessage('did-set-content', undefined);\n\t\t\t});\n\n\t\t\t// Forward message to the embedded iframe\n\t\t\thost.onMessage('message', (_event, data) => {\n\t\t\t\tconst pending = getPendingFrame();\n\t\t\t\tif (!pending) {\n\t\t\t\t\tconst target = getActiveFrame();\n\t\t\t\t\tif (target) {\n\t\t\t\t\t\ttarget.contentWindow.postMessage(data, '*');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpendingMessages.push(data);\n\t\t\t});\n\n\t\t\thost.onMessage('initial-scroll-position', (_event, progress) => {\n\t\t\t\tinitData.initialScrollProgress = progress;\n\t\t\t});\n\n\t\t\thost.onMessage('execCommand', (_event, data) => {\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (!target) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttarget.contentDocument.execCommand(data);\n\t\t\t});\n\n\t\t\ttrackFocus({\n\t\t\t\tonFocus: () => host.postMessage('did-focus'),\n\t\t\t\tonBlur: () => host.postMessage('did-blur')\n\t\t\t});\n\n\t\t\t// signal ready\n\t\t\thost.postMessage('webview-ready', {});\n\t\t});\n\t}\n\n\tif (typeof module !== 'undefined') {\n\t\tmodule.exports = createWebviewManager;\n\t} else {\n\t\twindow.createWebviewManager = createWebviewManager;\n\t}\n}());\n"]}